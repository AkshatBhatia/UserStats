<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Twitter Stats</title>
    <style type="text/css">

    </style>
</head>
<body>
<!-- ========= -->
<!-- Your HTML -->
<!-- ========= -->
<div class="container">
    <section id="twitterstatsapp">
        <header id="header">
            <h1>Twitter Stats</h1>
        </header>
        <section id="main">
            <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
            <table style="width:100%" class="table table-striped table-hover">
            <tbody id="tweet-list">
            </tbody>
            </table>
        </section>
    </section>
</div>
<!-- ========= -->
<!-- Libraries -->
<!-- ========= -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.3/backbone-min.js" type="text/javascript"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<!-- =============== -->
<!-- Javascript code -->
<!-- =============== -->
<script type="text/template" id="tweet-template">
    <td><a href='http://www.twitter.com/<%= author %>/status/<%= id_str %>'><%= id_str %></a></td>
    <td><a href='http://www.twitter.com/<%= author %>'><%= author %></a>    </td>
    <td><%= text %></td>
    <td><%= favorite_count %></td>
    <td><%= retweet_count %></td>
</script>

<script type="text/javascript">
    // your JS code goes here
    var app = {}; // create namespace for our app

    //Models
    app.Tweet = Backbone.Model.extend({
       defaults: {
           id_str: "id_str",
           author: "Author",
           text: "This is a tweet text",
           favorite_count: "favorite_count",
           retweet_count: "retweet_count",
       }
    });

    // Collections
    app.Tweets = Backbone.Collection.extend({
        model: app.Tweet,
        url: '/twitterstats/tweets/?format=json',
        parse: function(data) {
            return data.tweets;
        }
    });

    app.tweets = new app.Tweets();

    // Views
    app.TweetView = Backbone.View.extend({
        tagName: 'tr',
        template: _.template($('#tweet-template').html()),
        render: function(){
            this.$el.html(this.template(this.model.toJSON()));
            return this; // enable chained calls
        }
    });

    app.AppView = Backbone.View.extend({
        el: '#twitterstatsapp',
        headers: _.template('<tr><th>TweetId</th><th>Author</th><th>Text</th><th>Favorites</th><th>Retweets</th></tr>'),
        initialize: function () {
            app.tweets.on('add', this.addOne, this);
            app.tweets.on('reset', this.addAll, this);
            this.$('#tweet-list').html(this.headers);
            app.tweets.fetch();
        },
        addOne: function(tweet){
            var view = new app.TweetView({model: tweet});
            $('#tweet-list').append(view.render().el);
        },
        addAll: function(){
            this.$('#tweet-list').html(this.headers); // clean the todo list
            app.tweets.each(this.addOne, this);
        },
    });

    var appView = new app.AppView();
</script>

</body>
</html>
